schemaVersion: 2.0
category: pie
name: pie-filodb
users:
- pie-insights-ci

notificationRecipients:
- pie-insights-ci@group.apple.com

builds:
- branchName: internal-spark1.6
  timeout: 50
  machine:
    docker:
      baseImage: registry.is.apple.com/pie/cpbuild_jdk18_cass21:9cf26ed.1
  build:
    # NOTE: Run cassandra as root.  Logs get spewed out to STDOUT by default, better for debugging?
    template: freestyle:v1:snapshot
    steps:
    - 'echo "Java Home: $JAVA_HOME"'
    - sudo /apache-cassandra-2.1.12/bin/cassandra
    - cd /code
    - sbt test
    - sbt publish
    - rm -f .dist/publishable/com/apple/pie/filodb/*/*/*.md5 .dist/publishable/com/apple/pie/filodb/*/*/*.sha1
    - find .dist/publishable/ -type f
  publish:
    archives:
      includePattern: .dist/publishable/**/*
      targetPath: /
- branchName: internal-spark1.6
  name: prb-internal-spark1.6
  timeout: 50
  machine:
    docker:
      baseImage: registry.is.apple.com/pie/cpbuild_jdk18_cass21:9cf26ed.1
  build:
    template: freestyle:v1:prb
    # TODO: get a standard start script so we don't have to hardcode C* version
    steps:
    - 'echo "Java Home: $JAVA_HOME"'
    - sudo /apache-cassandra-2.1.12/bin/cassandra
    - cd /code
    - sbt test

